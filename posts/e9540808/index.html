<!DOCTYPE html><html class="theme-next gemini use-motion" lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/my-favicon-16x16.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="rovo98 rovo98's blog"><link rel="alternate" href="/atom.xml" title="rovo98's Blog" type="application/atom+xml"><meta name="description" content="Temporary file."><meta property="og:type" content="article"><meta property="og:title" content="Producer and Cusumer Problem"><meta property="og:url" content="http://rovo98.github.io/posts/e9540808/index.html"><meta property="og:site_name" content="rovo98&#39;s Blog"><meta property="og:description" content="Temporary file."><meta property="og:locale" content="en"><meta property="og:image" content="http://rovo98.github.io/posts/e9540808/critical-section-problem.png"><meta property="og:image" content="http://rovo98.github.io/posts/e9540808/circle-queue.png"><meta property="og:image" content="http://rovo98.github.io/posts/e9540808/Semaphores_2.png"><meta property="og:image" content="http://rovo98.github.io/posts/e9540808/monitors.png"><meta property="og:updated_time" content="2018-10-08T05:08:41.971Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Producer and Cusumer Problem"><meta name="twitter:description" content="Temporary file."><meta name="twitter:image" content="http://rovo98.github.io/posts/e9540808/critical-section-problem.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!0,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><script>"temporary"!==prompt("Please Enter the password!")&&(alert("Password Error！"),history.back())</script><title>Producer and Cusumer Problem | rovo98's Blog</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">rovo98's Blog</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Leave your comfort zone!</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> Home</a></li><li class="menu-item menu-item-top"><a href="/top/" rel="section"><i class="menu-item-icon fa fa-fw fa-signal"></i><br> Posts Ranking</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> Archives</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> Search</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://rovo98.github.io/posts/e9540808/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="rovo98"><meta itemprop="description" content=""><meta itemprop="image" content="/images/personal-logo.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="rovo98's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Producer and Cusumer Problem</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-29T22:00:00+08:00">2018-09-29</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Temporary/" itemprop="url" rel="index"><span itemprop="name">Temporary</span></a></span></span> <span id="/posts/e9540808/" class="leancloud_visitors" data-flag-title="Producer and Cusumer Problem"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">Visitors&#58;</span><span class="leancloud-visitors-count"></span></span> <span class="post-meta-divider">|</span><span class="page-pv"><i class="fa fa-file-o"></i><span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">Words count in article&#58;</span> <span title="Words count in article">1,394</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">Reading time &asymp;</span> <span title="Reading time">8</span></div></div></header><div class="post-body" itemprop="articleBody"><p>Temporary file.</p><a id="more"></a><h3 id="基本概念-Basic-concepts"><a href="#基本概念-Basic-concepts" class="headerlink" title="基本概念 (Basic concepts)"></a>基本概念 (Basic concepts)</h3><p>references to the <a href="https://www.geeksforgeeks.org/operating-systems/" target="_blank" rel="noopener">https://www.geeksforgeeks.org/operating-systems/</a>.</p><h4 id="1-进程分类"><a href="#1-进程分类" class="headerlink" title="1.进程分类"></a>1.进程分类</h4><p>进程同步中的进程分类:</p><blockquote><p>On the basis of synchronization, processes are categorized as one of the following two types:</p><ul><li><strong>Independent Process</strong> : Execution of one process does not affects the execution of other processes.</li><li><strong>Cooperative Process</strong> : Execution of one process affects the execution of other processes.</li></ul><p>Process synchronization problem arises in the case of Cooperative process also because resources are shared in Cooperative processes.</p></blockquote><h4 id="2-临界区问题"><a href="#2-临界区问题" class="headerlink" title="2.临界区问题"></a>2.临界区问题</h4><blockquote><p>Critical section is a code segment that can be accessed by only one process at a time. Critical section contains shared variables which need to be synchronized to maintain consistency of data variables.</p><p><img src="critical-section-problem.png" alt=""></p><p><strong>In simple terms a critical section is group of instructions/statements or region of code that need to be executed <span title="atomicity，consistency,isolation,durability.">atomically</span></strong>, such as accessing a resource (file, input or output port, global data, etc.).</p></blockquote><h4 id="3-临界区问题解决"><a href="#3-临界区问题解决" class="headerlink" title="3.临界区问题解决"></a>3.临界区问题解决</h4><p>Any solution to the critical section problem must satisfy three requirements:</p><ol><li><strong>Mutual Exclusion</strong> : If a process is executing in its critical section, then no other process is allowed to execute in the critical section.</li><li><strong>Progress</strong> : If no process is in the critical section, then no other process from outside can block it from entering the critical section.</li><li><strong>Bounded Waiting</strong> : A bound must exist on the number of times that other processes are allowed to enter their critical sections after a process has made a request to enter its critical section and before that request is granted.</li></ol><p>advantages:</p><ul><li>Mutual Exclusion is assured as only one process can access the critical section at any time.</li><li>Progress is also assured, as a process outside the critical section does not blocks other processes from entering the critical section.</li><li>Bounded Waiting is preserved as every process gets a fair chance.</li></ul><p>A simple solution to critical section can be thought as shown below,<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">acquireLock();</span><br><span class="line">Process Critical Section</span><br><span class="line">releaseLock();</span><br></pre></td></tr></table></figure><p></p><h3 id="临界区问题解决-同步机制的实现"><a href="#临界区问题解决-同步机制的实现" class="headerlink" title="临界区问题解决-同步机制的实现"></a>临界区问题解决-同步机制的实现</h3><p>为了方便大家理解<code>P53</code>给出的生产者-消费者问题的代码，我用类似画图的工具简单的画了下图:</p><p><img src="circle-queue.png" alt=""></p><h4 id="1-硬件同步机制"><a href="#1-硬件同步机制" class="headerlink" title="1. 硬件同步机制"></a>1. 硬件同步机制</h4><h5 id="TestAndSet"><a href="#TestAndSet" class="headerlink" title="TestAndSet"></a>TestAndSet</h5><p>TestAndSet is a hardware solution to the synchronization problem. In TestAndSet, we have a shared lock variable which can take either of the two values, 0 or 1.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0 Unlock</span><br><span class="line">1 Lock</span><br></pre></td></tr></table></figure><p>Before entering into the critical section, a process inquires about the lock. If it is locked, it keeps on waiting till it become free and if it is not locked, it takes the lock and executes the critical section.</p><p>Question : The enter_CS() and leave_CS() functions to implement critical section of a process are realized using test-and-set instruction as follows:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">int test-and-set(int &amp;lock) &#123;</span><br><span class="line">    int initial = lock;</span><br><span class="line">    lock = 1;</span><br><span class="line">    return initial;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void enter_CS(X)</span><br><span class="line">&#123;</span><br><span class="line">  while test-and-set(X) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void leave_CS(X)</span><br><span class="line">&#123;</span><br><span class="line">  X = 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Test-and-Set</code>解决临界区问题的伪代码可以写成下面这样的:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">enter_CS(X);</span><br><span class="line">processing critical section.</span><br><span class="line">leave_CS(X);</span><br></pre></td></tr></table></figure><p>In the above solution, X is a memory location associated with the CS and is initialized to 0.</p><p><strong>In TestAndSet, Mutual exclusion and progress are preserved but bounded waiting cannot be preserved.</strong></p><h4 id="2-信号量机制-Semaphore"><a href="#2-信号量机制-Semaphore" class="headerlink" title="2. 信号量机制(Semaphore)"></a>2. 信号量机制(Semaphore)</h4><p>Semaphores</p><p>A Semaphore is an integer variable, which can be accessed only through two operations <code>wait()</code> and <code>signal()</code>.</p><h5 id="信号量分类"><a href="#信号量分类" class="headerlink" title="信号量分类"></a>信号量分类</h5><p>There are two types of semaphores : Binary Semaphores and Counting Semaphores</p><ul><li><p><strong>Binary Semaphores</strong> : They can only be either 0 or 1. They are also known as mutex locks, as the locks can provide mutual exclusion. All the processes can share the same mutex semaphore that is initialized to 1. Then, a process has to wait until the lock becomes 0. Then, the process can make the mutex semaphore 1 and start its critical section. When it completes its critical section, it can reset the value of mutex semaphore to 0 and some other process can enter its critical section.</p></li><li><p><strong>Counting Semaphores</strong> : They can have any value and are not restricted over a certain domain. They can be used to control access a resource that has a limitation on the number of simultaneous accesses. The semaphore can be initialized to the number of instances of the resource. Whenever a process wants to use that resource, it checks if the number of remaining instances is more than zero, i.e., the process has an instance available. Then, the process can enter its critical section thereby decreasing the value of the counting semaphore by 1. After the process is over with the use of the instance of the resource, it can leave the critical section thereby adding 1 to the number of available instances of the resource.</p></li></ul><h5 id="Some-point-regarding-P-and-V-operation"><a href="#Some-point-regarding-P-and-V-operation" class="headerlink" title="Some point regarding P and V operation"></a>Some point regarding P and V operation</h5><ol><li>P operation is also called wait, sleep or down operation and V operation is also called signal, wake-up or up operation.</li><li>Both operations are atomic and semaphore(s) is always initialized to one.</li><li>A critical section is surrounded by both operations to implement process synchronization.See below image.critical section of Process P is in between P and V operation.<br><img src="Semaphores_2.png" alt=""></li></ol><p><strong>Using Mutex</strong>:</p><p>A mutex provides mutual exclusion, either producer or consumer can have the key (mutex) and proceed with their work. As long as the buffer is filled by producer, the consumer needs to wait, and vice versa.</p><p>At any point of time, only one thread can work with the entire buffer. The concept can be generalized using semaphore.</p><p><strong>Using Semaphore</strong>:</p><p>A semaphore is a generalized mutex. In lieu of single buffer, we can split the 4 KB buffer into four 1 KB buffers (identical resources). A semaphore can be associated with these four buffers. The consumer and producer can work on different buffers at the same time</p><p><strong>Misconception</strong>:</p><p>There is an ambiguity between binary semaphore and mutex. We might have come across that a mutex is binary semaphore. But they are not! The purpose of mutex and semaphore are different. May be, due to similarity in their implementation a mutex would be referred as binary semaphore.</p><p>Strictly speaking, a mutex is locking mechanism used to synchronize access to a resource. Only one task (can be a thread or process based on OS abstraction) can acquire the mutex. It means there is ownership associated with mutex, and only the owner can release the lock (mutex).</p><p>Semaphore is signaling mechanism (“I am done, you can carry on” kind of signal). For example, if you are listening songs (assume it as one task) on your mobile and at the same time your friend calls you, an interrupt is triggered upon which an interrupt service routine (ISR) signals the call processing task to wakeup.</p><h4 id="3-管程机制-Monitor"><a href="#3-管程机制-Monitor" class="headerlink" title="3. 管程机制(Monitor)"></a>3. 管程机制(Monitor)</h4><h5 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1.介绍"></a>1.介绍</h5><p>Monitor is one of the ways to achieve Process synchronization. Monitor is supported by programming languages to achieve mutual exclusion between processes. For example Java Synchronized methods. Java provides wait() and notify() constructs.</p><ol><li>It is the collection of condition variables and procedures combined together in a special kind of module or a package.</li><li>The processes running outside the monitor can’t access the internal variable of monitor but can call procedures of the monitor.</li><li>Only one process at a time can execute code inside monitors.</li></ol><h5 id="2-Syntax-of-Monitor"><a href="#2-Syntax-of-Monitor" class="headerlink" title="2.Syntax of Monitor"></a>2.Syntax of Monitor</h5><p><img src="monitors.png" alt=""></p><h5 id="3-Condition-Variables"><a href="#3-Condition-Variables" class="headerlink" title="3.Condition Variables"></a>3.Condition Variables</h5><p>Two different operations are performed on the condition variables of the monitor.</p><ol><li>Wait.</li><li>signal.</li></ol><p>let say we have 2 condition variables<br><code>condition x, y; //Declaring variable</code></p><p><strong>Wait operation</strong>:</p><p>x.wait() : Process performing wait operation on any condition variable are suspended. The suspended processes are placed in block queue of that condition variable.</p><p>Note: Each condition variable has its unique block queue.</p><p><strong>Signal operation</strong>:</p><p>x.signal(): When a process performs signal operation on condition variable, one of the blocked processes is given chance.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">If (x block queue empty)</span><br><span class="line">  // Ignore signal</span><br><span class="line">else</span><br><span class="line">  // Resume a process from block queue.</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------The End<i class="fa fa-coffee"></i> Thanks for reading.-------------</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>Donate me, thanks for your support!</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>Donate</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/images/wechat_code.jpg" alt="rovo98 WeChat Pay"><p>WeChat Pay</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/images/alipay_code.jpg" alt="rovo98 Alipay"><p>Alipay</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>Post author:</strong> rovo98</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="http://rovo98.github.io/posts/e9540808/" title="Producer and Cusumer Problem">http://rovo98.github.io/posts/e9540808/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</li></ul></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/97c4fd12/" rel="next" title="编译自己的Vim8.1"><i class="fa fa-chevron-left"></i> 编译自己的Vim8.1</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/posts/3babee60/" rel="prev" title="记录一次linux系统迁移过程">记录一次linux系统迁移过程<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><script>window._bd_share_config={common:{bdText:"",bdMini:"1",bdMiniList:!1,bdPic:""},image:{viewList:["tsina","douban","sqq","qzone","weixin","twi","fbook"],viewText:"分享到：",viewSize:"16"},slide:{bdImg:"5",bdPos:"left",bdTop:"100"}}</script><script>with(document)(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="/static/api/js/share.js?cdnversion="+~(-new Date/36e5)</script></div></div></div><div id="gitalk-container"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> Overview</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/personal-logo.jpg" alt="rovo98"><p class="site-author-name" itemprop="name">rovo98</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">37</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">28</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">26</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/rovo98" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Friend Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://dcLunatic.github.io" title="dcLunatic" target="_blank">dcLunatic</a></li><li class="links-of-blogroll-item"> <a href="https://adj325.github.io" title="Adj325" target="_blank">Adj325</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本概念-Basic-concepts"><span class="nav-number">1.</span> <span class="nav-text">基本概念 (Basic concepts)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-进程分类"><span class="nav-number">1.1.</span> <span class="nav-text">1.进程分类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-临界区问题"><span class="nav-number">1.2.</span> <span class="nav-text">2.临界区问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-临界区问题解决"><span class="nav-number">1.3.</span> <span class="nav-text">3.临界区问题解决</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#临界区问题解决-同步机制的实现"><span class="nav-number">2.</span> <span class="nav-text">临界区问题解决-同步机制的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-硬件同步机制"><span class="nav-number">2.1.</span> <span class="nav-text">1. 硬件同步机制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#TestAndSet"><span class="nav-number">2.1.1.</span> <span class="nav-text">TestAndSet</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-信号量机制-Semaphore"><span class="nav-number">2.2.</span> <span class="nav-text">2. 信号量机制(Semaphore)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#信号量分类"><span class="nav-number">2.2.1.</span> <span class="nav-text">信号量分类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Some-point-regarding-P-and-V-operation"><span class="nav-number">2.2.2.</span> <span class="nav-text">Some point regarding P and V operation</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-管程机制-Monitor"><span class="nav-number">2.3.</span> <span class="nav-text">3. 管程机制(Monitor)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-介绍"><span class="nav-number">2.3.1.</span> <span class="nav-text">1.介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-Syntax-of-Monitor"><span class="nav-number">2.3.2.</span> <span class="nav-text">2.Syntax of Monitor</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-Condition-Variables"><span class="nav-number">2.3.3.</span> <span class="nav-text">3.Condition Variables</span></a></li></ol></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-user-secret"></i></span> <span class="author" itemprop="copyrightHolder">rovo98. All rights reserved.</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">64.7k</span></div><div class="footer-custom">The end always is near.</div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span><span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script type="text/javascript">var gitalk=new Gitalk({clientID:"c9d1854c8941ed48db62",clientSecret:"577ebec8a9a4e414346be5a1d9ccb0741417c910",repo:"rovo98.github.io",owner:"rovo98",admin:["rovo98"],id:location.pathname,distractionFreeMode:"true"});gitalk.render("gitalk-container")</script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('5');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("z6k4uD5nvz0L4yBDrkeEhOfq-gzGzoHsz","eiWBqdCDNSKEjz1o1nvUel7W")</script><script>function showTime(e){var t=new AV.Query(e),c=[],u=$(".leancloud_visitors");u.each(function(){c.push($(this).attr("id").trim())}),t.containedIn("url",c),t.find().done(function(e){var t=".leancloud-visitors-count";if(0!==e.length){for(var n=0;n<e.length;n++){var o=e[n],i=o.get("url"),s=o.get("time"),r=document.getElementById(i);$(r).find(t).text(s)}for(n=0;n<c.length;n++){i=c[n],r=document.getElementById(i);var l=$(r).find(t);""==l.text()&&l.text(0)}}else u.find(t).text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(i){var e=$(".leancloud_visitors"),s=e.attr("id").trim(),r=e.attr("data-flag-title").trim(),t=new AV.Query(i);t.equalTo("url",s),t.find({success:function(e){if(0<e.length){var t=e[0];t.fetchWhenSave(!0),t.increment("time"),t.save(null,{success:function(e){$(document.getElementById(s)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var n=new i,o=new AV.ACL;o.setPublicReadAccess(!0),o.setPublicWriteAccess(!0),n.setACL(o),n.set("title",r),n.set("url",s),n.set("time",1),n.save(null,{success:function(e){$(document.getElementById(s)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):1<$(".post-title-link").length&&showTime(e)})</script><div class="bg_content"><canvas id="canvas"></canvas></div><script type="text/javascript" src="/js/src/dynamic_bg.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",model:{jsonPath:"/live2dw/assets/koharu.model.json"},display:{position:"right",width:80,height:180},mobile:{show:!1}})</script></body></html>